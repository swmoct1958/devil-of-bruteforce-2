### 第1章：組合せの迷宮 ―― 魔法陣の数学的性質

魔法陣（魔方陣）は、単なるパズルを超え、古代から数学者を虜にしてきた「数の調和」の象徴です。本章では、全探索という「力業」に挑む前に、我々を導く北極星となる数学的な制約を整理します。

#### 1-1. 定数和 $S = \frac{n(n^2+1)}{2}$ の導出
魔法陣の定義は、 $n \times n$ の正方形に $1$ から $n^2$ までの数字を重複なく配置し、縦・横・対角線の各列の和をすべて等しくすることです。この等しくなる和を「定数和（魔法和）」と呼びます。

この $S$ の値は、以下の論理で導き出せます。
1. $1$ から $m$ までの総和は $\frac{m(m+1)}{2}$ である。
2. 魔法陣には $1$ から $n^2$ までの数が入るため、全体の総和は $m = n^2$ を代入し、 $\frac{n^2(n^2+1)}{2}$ となる。
3. 全 $n$ 行の和がすべて $S$ になる必要があるため、全体の総和を $n$ で割ることで、一行あたりの和 $S$ が求まる。

$$S = \frac{n^2(n^2+1)}{2n} = \frac{n(n^2+1)}{2}$$



たとえば、$3 \times 3$ なら $S=15$、$4 \times 4$ なら $S=34$ となり、これが全探索における最も重要な「チェック基準」となります。

#### 1-2. $O((n^2)!)$ の衝撃：n-Queenを超える絶望的な探索空間
前著で扱った n-Queen問題では、クイーンを各行に一つずつ置くという制約から、探索空間は $n!$ 程度に抑えられていました。しかし、魔法陣は過酷です。

$n \times n$ のマス目に $1$ から $n^2$ までの異なる数字を並べる組み合わせは、 $(n^2)!$ 通り存在します。
* **$3 \times 3$ ($n=3$):** $9! = 362,880$ 通り。
* **$4 \times 4$ ($n=4$):** $16! \approx 2.09 \times 10^{13}$ 通り。
* **$5 \times 5$ ($n=5$):** $25! \approx 1.55 \times 10^{25}$ 通り。

この指数関数的どころではない爆発的な増加こそが、魔法陣を「全探索の迷宮」たらしめている理由です。工夫のない全探索は、 $n=4$ でさえ現代の計算機に数時間の負荷を強いることになります。
